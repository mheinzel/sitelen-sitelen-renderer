var sitelenCoreRenderer=function(){"use strict";function e(e,t,n,r){var o=r?document.createElementNS(r,e):document.createElement(e);for(var i in t)t.hasOwnProperty(i)&&(t[i].ns?o.setAttributeNS(t[i].ns,i,t[i].value):o.setAttribute(i,t[i]));for(var a in n)n.hasOwnProperty(a)&&(o.style[a]=n[a]);return o}function t(e,t){var n=[t*(e.ratio<.667?1.2:.92),t*(e.ratio<.667?.9:.92),0,0];return 1===e.ratio&&"o"===e.separator&&(n[1]=1*t,n[3]=-10),e.ratio<.667&&"o"===e.separator&&(n[0]=1*t,n[1]=.88*t,n[3]=-15),e.ratio>1.5&&"o"===e.separator&&(n[1]=1*t,n[2]=-15,n[3]=-10),1===e.ratio&&"e"===e.separator&&(n[0]=1*t),e.ratio>1.5&&"pi"===e.separator&&(n[1]=1.5*t),1===e.ratio&&"e"===e.separator&&(n[2]=10),1===e.ratio&&"tawa"===e.separator&&(n[0]=.9*t,n[1]=.9*t,n[2]=5,n[3]=-10),1===e.ratio&&"lon"===e.separator&&(n[2]=15,n[3]=-15),e.ratio>1.5&&"e"===e.separator&&(n[2]=5),e.ratio>1.5&&"tawa"===e.separator&&(n[2]=10),n}function n(e,t){var n=e.separator?1.1*t:1.02;return 1===e.ratio&&"e"===e.separator&&(n=1.2*t),1===e.ratio&&"tawa"===e.separator&&(n=1.2*t),1===e.ratio&&"lon"===e.separator&&(n=1.4*t),n}function r(o,i,a,s,u,p){var f=i,h=a.scale/1.1,d=a.scale,v=t(o,a.scale),g=n(o,a.scale);if(s){var m=[100*s[0]/p[0],100*s[1]/p[1],100*u[0]/p[0],100*u[1]/p[1]],x=[m[0]+m[2]/2,m[1]+m[3]/2],y=[];if(o.separator){y=[v[0],0,0,v[1],x[0]-v[0]*x[0],x[1]-v[1]*x[1]];var w=e("use",{href:{ns:c,value:"#tp-c-"+o.separator+(o.ratio>1.5?"-wide":o.ratio<.667?"-tall":"")},transform:"matrix("+y.join(",")+")",height:m[3],width:m[2],x:m[0],y:m[1]},{},l);"cartouche"===o.separator?i.appendChild(w):i.insertBefore(w,i.firstChild)}y=[h,0,0,h,x[0]-h*x[0],x[1]-h*x[1]],f=e("svg",{viewBox:[v[2]-(100*g-100)/2,("punctuation"===o.type?20:v[3])-(100*g-100)/2,100*g,100*g].join(" "),preserveAspectRatio:"none",height:m[3],width:m[2],x:m[0],y:m[1]},{overflow:"visible"},l),"punctuation"===o.type?i.insertBefore(f,i.firstChild):i.appendChild(f)}o.state.units.forEach(function(t){if("word-glyph"===t.unit.rule||"syl-glyph"===t.unit.rule){var n=[100*t.position[0]/o.size[0],100*t.position[1]/o.size[1],100*t.size[0]/o.size[0],100*t.size[1]/o.size[1]],i=[n[0]+n[2]/2,n[1]+n[3]/2],s=[d,0,0,d,i[0]-d*i[0],i[1]-d*i[1]],u=e("use",{href:{ns:c,value:"word-glyph"===t.unit.rule?"#tp-wg-"+t.unit.token:"#tp-syl-"+t.unit.token},transform:"matrix("+s.join(",")+")",height:n[3],width:n[2],x:n[0],y:n[1]},{},l);f.insertBefore(u,f.firstChild)}else r(t.unit,f,a,t.position,t.size,o.size)})}function o(t,n,o){o||(o={}),o.scale||(o.scale=1.2),o.scaleSkew||(o.scaleSkew=1.3),o.shadow||(o.shadow=!1);var i=0,a=0;t.forEach(function(e){i=Math.max(i,e.size[0])}),t.forEach(function(e){a+=e.size[1]*i/e.size[0]});var u=[0,0,100*i,100*a],p=e("svg",{xmlns:l,"xmlns:xlink":c,version:1.2,preserveAspectRatio:"xMidYMin meet",viewBox:[-(u[2]*o.scale-u[2])/2,-(u[3]*o.scaleSkew-u[3])/2,u[2]*o.scaleSkew,u[3]*o.scaleSkew].join(" ")},{},l);p.setAttribute("data-sitelen-sentence",null);var f=document.createElement("style");if(f.innerHTML="ellipse,polygon,polyline,rect,circle,line,path{stroke-width:2;stroke:black;vector-effect:non-scaling-stroke} .filler{stroke:none;}",p.appendChild(f),o.shadow){var h=e("filter",{id:"shadow",width:"150%",height:"150%"},{},l);h.innerHTML='<feOffset result = "offOut" in = "SourceGraphic" dx = "0" dy = "2"></feOffset><feColorMatrix result = "matrixOut" in = "offOut" type = "matrix" values = "0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"></feColorMatrix><feGaussianBlur result = "blurOut" in = "matrixOut" stdDeviation = "2"></feGaussianBlur><feBlend in = "SourceGraphic" in2 = "blurOut" mode = "normal"></feBlend>',p.appendChild(h)}var d=0;t.forEach(function(t){var n=[0,0,100*i,t.size[1]*i/t.size[0]*100],a=e("svg",{width:n[2],height:n[3],viewBox:[0,0,100,100].join(" "),y:d,preserveAspectRatio:"none",filter:o.shadow?"url(#shadow)":""},{overflow:"visible"},l);d+=n[3],r(t,a,o),p.appendChild(a),o.ignoreHeight||requestAnimationFrame(function(){var e=p.getBoundingClientRect();p.style.height=e.height/o.scale+"px"})});var v={};return o.exportable&&[].slice.call(p.getElementsByTagName("use")).forEach(function(e){var t=e.getAttribute("href"),n=s.querySelector(t);n?(v[t]||p.appendChild(n.cloneNode(!0)),v[t]=!0):console.log("WARNING: symbol "+t+" cannot be found.")}),n.appendChild(p),p}function i(t,n,o){if(!t)return void console.log("WARNING: nothing to render");o||(o={}),o.scale||(o.scale=1.2);var i=[0,0,100*t.size[0],100*t.size[1]],a=e("svg",{xmlns:l,"xmlns:xlink":c,version:1.1,viewBox:[-(i[2]*o.scale-i[2])/2,-(i[3]*o.scale-i[3])/2,i[2]*o.scale,i[3]*o.scale].join(" ")},{display:"block"},l),u=e("svg",{width:i[2],height:i[3],viewBox:[0,0,100,100].join(" "),preserveAspectRatio:"none"},{overflow:"visible"},l);return r(t,u,o),a.appendChild(u),o.exportable&&[].slice.call(a.getElementsByTagName("use")).forEach(function(e){var t=e.getAttribute("href"),n=s.querySelector(t);n?a.appendChild(n.cloneNode(!0)):console.log("WARNING: symbol "+t+" cannot be found.")}),n.appendChild(a),a}function a(e){e.forEach(function(e){i(e,document.getElementById("sitelen"),{scale:1.2,exportable:!0})})}var s,u=new XMLHttpRequest;u.open("get","../../images/sprite.css.svg",!1),u.onreadystatechange=function(){if(4===u.readyState){var e=u.responseXML.documentElement;s=e;var t=document.importNode(e,!1);setTimeout(function(){document.body.appendChild(t)},0)}},u.send();var l="http://www.w3.org/2000/svg",c="http://www.w3.org/1999/xlink";return{renderLayoutOption:i,renderComplexLayout:o,renderAllOptions:a}}(),sitelenLayout=function(){"use strict";function e(e){function t(e){e=JSON.parse(e);var t=1;return e.state.units.forEach(function(e){e.size[0]<t&&(t=Math.max(e.size[0],e.size[1]))}),e.size=[e.size[0]/t,e.size[1]/t],e.surface/=t*t,e.state.units.forEach(function(e){e.size[0]/=t,e.size[1]/=t,e.position[0]/=t,e.position[1]/=t}),e}function n(e,a,s){var u,l,c,p,f,h,d,v,g,m,x;if(a){h=s.goesDown,d=s.index,v=s.length,l=JSON.parse(JSON.stringify(a)),u=l.size,c=l.forbidden,g=e[d].size,m=[h?0:a.size[0],h?a.size[1]:0];var y,w=[0,0];for(p=d;p<d+v;p++){if(y=e[p].size,h&&y[1]!==g[1]||!h&&y[0]!==g[0])return;w=[w[0]+y[0],w[1]+y[1]]}for(p=d;p<d+v;p++){var k=[],b=0,E=h?1:0,z=h?0:1;if(y=e[p].size,b=y[E]*a.size[z]/w[z],k[E]=b,k[z]=y[z]*b/y[E],p===d&&(u[E]+=b),h&&c.indexOf(JSON.stringify(m))>-1)return;g=y,l.units.push({unit:e[p],size:k,position:m}),m=[m[0]+(h?k[0]:0),m[1]+(h?0:k[1])],c.push(JSON.stringify([m[0]+(h?0:k[0]),m[1]+(h?k[1]:0)]))}if(d+v===e.length)return x={type:"container",state:l,size:u,ratio:u[0]/u[1],normedRatio:u[0]/u[1]<1?u[0]/u[1]:u[1]/u[0],surface:u[0]*u[1]},x=t(JSON.stringify(x)),i=Math.min(i,x.surface),void(!o[JSON.stringify(x)]&&x.surface/i<2&&(r.push(x),o[JSON.stringify(x)]=x));for(f=1;f<e.length-(d+v)+1;f++)n(e,l,{goesDown:!1,index:d+v,length:f}),n(e,l,{goesDown:!0,index:d+v,length:f})}else{var O=e[0].size;if(l={units:[{unit:e[0],size:O,position:[0,0]}],size:O,forbidden:[JSON.stringify(O)]},1===e.length)return x={type:"container",state:l,size:O,ratio:O[0]/O[1],normedRatio:O[0]/O[1]<1?O[0]/O[1]:O[1]/O[0],surface:O[0]*O[1]},r.push(x),void(o[JSON.stringify(x)]=x);for(f=1;f<e.length;f++)n(e,l,{goesDown:!1,index:1,length:f}),n(e,l,{goesDown:!0,index:1,length:f})}}var r=[],o={},i=1e6;return n(e),r}function t(t){function n(e){return s.indexOf(e)>-1?[4,.5]:a.indexOf(e)>-1?[4,.75]:u.indexOf(e)>-1?[4,1]:o.indexOf(e)>-1?[1,.5]:i.indexOf(e)>-1?[.5,1]:[1,1]}var r,o=["kon","lili","mute","sin"],i=["wan","tu","anu","en","kin"],a=["period","exclamation","question"],s=["comma","colon"],u=["la","banner"],l=[];return t.forEach(function(e){l.push({rule:"word-glyph",token:e,size:n(e)})}),r=e(l)}function n(t){function n(e){return o.indexOf(e)>-1?[.5,1]:[1,1]}var r,o=["li","ni","si","lin","nin","sin","le","ne","se","len","nen","sen","lo","no","so","lon","non","son","la","na","sa","lan","nan","san","lu","nu","su","lun","nun","sun"],i=[];return t.forEach(function(e){i.push({rule:"syl-glyph",token:e,size:n(e)})}),r=e(i)}function r(o){function i(t,n){a[t].options.forEach(function(r){var o=t+1,u=n.slice(0);r.type="punctuation"===a[t].part?"punctuation":"container",r.separator=a[t].sep,u.push(r),o<a.length?i(o,u):s.push.apply(s,e(u))})}var a=[],s=[];return o.forEach(function(e){var o=[];o=e.parts?r(e.parts):"cartouche"===e.sep?n(e.tokens):t(e.tokens),a.push({part:e.part,sep:e.sep,options:o})}),a.length>0?i(0,[]):console.log("WARNING: empty text to layout"),s}return{layoutCompound:r}}(),sitelenRenderer=function(){"use strict";function e(e,t,n){n||(n={}),n.exportable||(n.exportable=!0),n.optimalRatio||(n.optimalRatio=.75),n.minRatio||(n.minRatio=0),n.maxRatio||(n.maxRatio=100),n.ignoreHeight||(n.ignoreHeight=!1),n.random||(n.random=!1);var r=[],o=[];e.forEach(function(e){o.push(e),"punctuation"===e.part&&(r.push(o),o=[])}),o.length>0&&r.push(o);var i=[],a=function(e){return function(t,n){return Math.abs(e-t.ratio)-Math.abs(e-n.ratio)}};return r.forEach(function(e){var t=sitelenLayout.layoutCompound(e);t=t.filter(function(e){return e.ratio>n.minRatio&&e.ratio<n.maxRatio}),t.sort(a(n.optimalRatio)),i.push(t[n.random?Math.floor(Math.random()*t.length):0])}),sitelenCoreRenderer.renderComplexLayout(i,t,n)}function t(t){function n(n){var o=[];t.forEach(function(e){e.tokens&&e.tokens.forEach(function(e){o.push(e)})});var i=o.join("-")+".svg",a=r.querySelector("svg");a&&r.removeChild(a),e(t,r,{optimalRatio:n});var u='<?xml version="1.0" encoding="utf-8"?>\n'+r.querySelector("svg").innerHTML;s.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(u)),s.setAttribute("download",i)}var r=document.createElement("div");document.getElementById("sitelen").appendChild(r);var o=sitelenLayout.layoutCompound(t);o.sort(function(e,t){return e.ratio-t.ratio});var i=[0,100];o.forEach(function(e,t){var n=Math.abs(e.ratio-.8);n<i[1]&&(i=[t,n])});var a=document.createElement("input");a.setAttribute("type","range"),a.setAttribute("min",0),a.setAttribute("max",o.length-1),a.setAttribute("step",1),a.setAttribute("value",i[0]),a.addEventListener("input",function(e){var t=o[a.value].ratio;n(t)}),r.appendChild(a);var s=document.createElement("a");return s.innerHTML="download as SVG",r.appendChild(s),n(.8),r}function n(){[].slice.call(document.querySelectorAll("[data-sitelen]")).forEach(function(t){var n=t.textContent,r=sitelenParser.parse(n);t.innerHTML="";var o=t.getAttribute("data-sitelen-ratio");r.forEach(function(n,r){e(n,t,{optimalRatio:o?o:.8})})})}return window.onload=function(){n()},{renderCompoundSentence:e,renderInteractiveSentence:t}}(),sitelenParser=function(){"use strict";function e(e){var t=e.split(" "),n=["tawa","lon","kepeken"],r=["li","e"],o={part:"subject",tokens:[]},i=[o];return t.forEach(function(e,a){return r.indexOf(e)>-1&&a<t.length-1?(i.push({part:"objectMarker",sep:e,tokens:[]}),void(o=i[i.length-1])):n.indexOf(e)>-1&&r.indexOf(t[a-1])===-1&&a<t.length-1&&r.indexOf(t[a+1])===-1?(i.push({part:"prepPhrase",sep:e,tokens:[]}),void(o=i[i.length-1])):"o"===e&&o.tokens.length>0?void(o.sep="o"):"a"===e&&o.tokens.length>0&&o.sep?(i.push({part:"interjection",sep:null,tokens:[e]}),void(o=i[i.length-1])):void o.tokens.push(e)}),i=i.filter(function(e){return e.tokens.length>0})}function t(e){var t=e.match(/[^\.!\?#]+[\.!\?#]+/g),n=[],r=[];return t||(t=[e+"|"],console.log("WARNING: sentence fraction without punctuation")),t.forEach(function(e){e=e.trim();var t=[];n.push(t),r.push(e);var o=e.substr(0,e.length-1);o=o.replace(", la "," la "),o=o.replace(", li "," li ");var i=o.split(/ la /);i.forEach(function(e,n){var r=e.split(/:/);r.forEach(function(e,n){var o=e.split(/,/);o.forEach(function(e,n){e=e.trim(),t.push({content:e}),n<o.length-1&&t.push({punctuation:["comma"]})}),n<r.length-1&&t.push({punctuation:["colon"]})}),2===i.length&&0===n&&t.push({punctuation:["la"]})});var a=e.substr(-1);switch(a){case".":t.push({punctuation:["period"]});break;case":":t.push({punctuation:["colon"]});break;case"!":t.push({punctuation:["exclamation"]});break;case"?":t.push({punctuation:["question"]});break;case"#":t.push({punctuation:["banner"]})}}),{parsable:n,raw:r}}function n(e){if(0===e.length)return[];var t=["o","u","i","a","e"],r=[],o=e.substr(0,1),i=e.substr(2,1),a=e.substr(3,1);if(t.indexOf(o)===-1)"n"===i&&t.indexOf(a)===-1?(r.push(e.substr(0,3)),r=r.concat(n(e.substr(3)))):(r.push(e.substr(0,2)),r=r.concat(n(e.substr(2))));else{if(2===e.length)return[e];r.push(o),r=r.concat(n(e.substr(1)))}return r}function r(e){var t,r,o=["lon","tan","kepeken","tawa","pi"];return e.forEach(function(n,r){if(t=-1,n.tokens.forEach(function(e,r){o.indexOf(e)>-1&&r<n.tokens.length-1&&(t=r)}),t>-1){var i=[];t>0&&i.push({part:n.part,tokens:n.tokens.slice(0,t)}),i.push({part:n.part,sep:n.tokens[t],tokens:n.tokens.slice(t+1)}),e[r]={part:n.part,sep:n.sep,parts:i}}}),e.forEach(function(t,o){if(r=-1,t.tokens&&(t.tokens.forEach(function(e,t){e.substr(0,1).toUpperCase()===e.substr(0,1)&&(r=t)}),r>-1)){var i=[];r>0&&i.push({part:t.part,tokens:t.tokens.slice(0,r)}),i.push({part:t.part,sep:"cartouche",tokens:n(t.tokens[r].toLowerCase())}),r<t.tokens.length-1&&i.push({part:t.part,tokens:t.tokens.slice(r+1)}),e[o]={part:t.part,sep:t.sep,parts:i}}}),e}function o(t){var n=[];return t.forEach(function(t){if(t.content){var r=[];t.content=t.content.replace(/([A-Z][\w-]*)/g,function(e){return r.push(e),"'Name'"});var o=e(t.content);o.forEach(function(e){e.tokens.forEach(function(t,n){"'Name'"===t&&(e.tokens[n]=r.shift())})}),n.push.apply(n,o)}else t.punctuation&&n.push({part:"punctuation",tokens:t.punctuation})}),n=r(n)}function i(e){return t(e.replace(/\s\s+/g," ")).parsable.map(function(e){return o(e)})}return{parse:i}}();